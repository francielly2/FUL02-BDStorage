import React, { useState, useEffect } from "react";

// LojaFones - App.jsx
// Requisitos: TailwindCSS no projeto para que as classes funcionem.

const PRODUCTS = [
  {
    id: 1,
    name: "Fone Bluetooth X200",
    type: "Bluetooth",
    price: 249.9,
    battery: "30h",
    color: "Preto",
    img: "https://via.placeholder.com/520x320?text=Fone+X200",
    desc: "Som cristalino, cancelamento de ruÃ­do ativo e microfone integrado.",
  },
  {
    id: 2,
    name: "Gamer Bass Pro",
    type: "Gamer",
    price: 399.0,
    battery: "20h",
    color: "Preto/Vermelho",
    img: "https://via.placeholder.com/520x320?text=Gamer+Bass+Pro",
    desc: "IluminaÃ§Ã£o RGB, microfone destacÃ¡vel e drivers potentes para graves.",
  },
  {
    id: 3,
    name: "Sport Fit Ear",
    type: "Esportivo",
    price: 179.0,
    battery: "12h",
    color: "Branco",
    img: "https://via.placeholder.com/520x320?text=Sport+Fit+Ear",
    desc: "Leves, resistÃªncia Ã  Ã¡gua IPX5 e encaixe firme para treinos.",
  },
  {
    id: 4,
    name: "Classic Wired",
    type: "Com fio",
    price: 59.9,
    battery: "--",
    color: "Azul",
    img: "https://via.placeholder.com/520x320?text=Classic+Wired",
    desc: "Fone com fio, leve e Ã³timo custo-benefÃ­cio para uso diÃ¡rio.",
  },
];

function currencyBRL(number) {
  return number.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

export default function App() {
  const [products] = useState(PRODUCTS);
  const [filter, setFilter] = useState("Todos");
  const [cart, setCart] = useState([]);
  const [query, setQuery] = useState("");
  const [selected, setSelected] = useState(null);

  useEffect(() => {
    const saved = localStorage.getItem("lojaFones_cart");
    if (saved) setCart(JSON.parse(saved));
  }, []);

  useEffect(() => {
    localStorage.setItem("lojaFones_cart", JSON.stringify(cart));
  }, [cart]);

  function addToCart(product) {
    setCart((prev) => {
      const found = prev.find((p) => p.id === product.id);
      if (found) return prev.map((p) => (p.id === product.id ? { ...p, qty: p.qty + 1 } : p));
      return [...prev, { ...product, qty: 1 }];
    });
  }

  function changeQty(productId, delta) {
    setCart((prev) =>
      prev
        .map((p) => (p.id === productId ? { ...p, qty: Math.max(1, p.qty + delta) } : p))
        .filter(Boolean)
    );
  }

  function removeFromCart(productId) {
    setCart((prev) => prev.filter((p) => p.id !== productId));
  }

  const total = cart.reduce((s, p) => s + p.price * p.qty, 0);

  function openWhatsAppCheckout() {
    if (cart.length === 0) return alert("Seu carrinho estÃ¡ vazio ðŸ˜…");
    const itemsText = cart
      .map((p) => `${p.qty}x ${p.name} - ${currencyBRL(p.price)} cada`)
      .join("\n");
    const message = `OlÃ¡! Gostaria de fazer um pedido:\n${itemsText}\nTotal: ${currencyBRL(total)}`;
    const encoded = encodeURIComponent(message);
    // substitua o nÃºmero abaixo pelo nÃºmero do vendedor no formato internacional sem + (ex: 5511999999999)
    const sellerNumber = "5511999999999";
    window.open(`https://wa.me/${sellerNumber}?text=${encoded}`, "_blank");
  }

  function fakePixCheckout() {
    alert(
      "Checkout via Pix (simulado). VocÃª pode gerar um QR Code PIX real integrando com provedores como Gerencianet, Mercado Pago ou Pagar.me. Total: " +
        currencyBRL(total)
    );
  }

  function filteredProducts() {
    return products.filter((p) => (filter === "Todos" ? true : p.type === filter)).filter((p) =>
      p.name.toLowerCase().includes(query.toLowerCase())
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 text-gray-900">
      <header className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6">
